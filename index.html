<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Default to dark mode, script will adjust -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <link rel="stylesheet" href="style.css">
    
    <!-- This script handles theme switching based on system preference -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
    </script>
    
    <!-- Your main application logic -->
    <script type="module" src="app.js" defer></script>
</head>
<body class="antialiased text-slate-800 dark:text-slate-200">

    <!-- Config Error Overlay -->
    <div id="config-error-screen" class="hidden fixed inset-0 bg-red-900 text-white p-8 flex items-center justify-center z-50">
        <div class="text-center max-w-2xl"><h1 class="text-4xl font-bold mb-4">Configuration Error</h1><p class="text-xl mb-6">Your Firebase API keys are missing from <code>app.js</code>.</p><p class="text-lg bg-red-800 p-4 rounded-lg">To fix this, open <code>app.js</code>, find the <code>firebaseConfig</code> object, and paste in your keys from the Firebase console.</p></div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="screen min-h-screen flex items-center justify-center bg-slate-900 p-4">
        <div class="w-full max-w-sm">
            <form id="login-form" class="bg-slate-800 p-8 rounded-2xl shadow-2xl">
                <h2 class="text-3xl font-bold text-center mb-6 text-white">Log In</h2>
                <div class="mb-4">
                    <label for="login-email" class="block text-slate-400 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="login-email" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-white" required>
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-slate-400 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="login-password" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-white" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform hover:scale-105">Log In</button>
                <p class="text-center text-sm text-slate-400 mt-6">No account? <a href="#" id="show-signup-link" class="font-bold text-indigo-400 hover:underline">Sign up</a></p>
            </form>
            <form id="signup-form" class="bg-slate-800 p-8 rounded-2xl shadow-2xl hidden">
                <h2 class="text-3xl font-bold text-center mb-6 text-white">Sign Up</h2>
                <div class="mb-4">
                    <label for="signup-email" class="block text-slate-400 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="signup-email" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-white" required>
                </div>
                <div class="mb-6">
                    <label for="signup-password" class="block text-slate-400 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="signup-password" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-white" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform hover:scale-105">Create Account</button>
                <p class="text-center text-sm text-slate-400 mt-6">Already have an account? <a href="#" id="show-login-link" class="font-bold text-indigo-400 hover:underline">Log in</a></p>
            </form>
            <p id="auth-error-message" class="text-red-400 h-6 mt-4 text-center"></p>
        </div>
    </div>
    
    <!-- DASHBOARD SCREEN -->
    <div id="dashboard-screen" class="screen hidden overflow-y-auto h-screen bg-slate-100 dark:bg-slate-900">
        <div class="p-4 sm:p-6 md:p-8 max-w-7xl mx-auto">
            <header class="flex justify-between items-center pb-4 border-b border-slate-200 dark:border-slate-700">
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Mission Control</h1>
                <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Log Out</button>
            </header>
            <main class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-3 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700">
                    <h2 class="font-bold text-lg text-slate-800 dark:text-slate-200">Net Profit (All Time)</h2>
                    <p id="dashboard-profit" class="text-5xl font-bold mt-2">$0.00</p>
                </div>
                <div id="financials-card" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 hover:scale-105 hover:shadow-2xl transition-all cursor-pointer">
                    <h2 class="font-bold text-xl mb-2 text-indigo-600 dark:text-indigo-400">Financials</h2>
                    <p class="text-slate-600 dark:text-slate-400">Track income and expenses.</p>
                </div>
                <div id="manage-clients-card" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 hover:scale-105 hover:shadow-2xl transition-all cursor-pointer">
                    <h2 class="font-bold text-xl mb-2 text-indigo-600 dark:text-indigo-400">Clients</h2>
                    <p class="text-slate-600 dark:text-slate-400">View, add, and edit profiles.</p>
                </div>
                <div id="scheduling-card" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 hover:scale-105 hover:shadow-2xl transition-all cursor-pointer">
                    <h2 class="font-bold text-xl mb-2 text-indigo-600 dark:text-indigo-400">Calendar</h2>
                    <p class="text-slate-600 dark:text-slate-400">Manage your appointments.</p>
                </div>
            </main>
        </div>
    </div>
    
    <!-- FINANCIALS SCREEN -->
    <div id="financials-screen" class="screen hidden overflow-y-auto h-screen bg-slate-100 dark:bg-slate-900">
        <div class="p-4 sm:p-6 md:p-8 max-w-7xl mx-auto">
            <header class="flex items-center pb-4 border-b border-slate-200 dark:border-slate-700">
                <button class="back-to-dashboard mr-4 p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                </button>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Financials</h1>
            </header>
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 space-y-8">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700">
                        <h2 class="text-xl font-semibold mb-4">Summary</h2>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center"><p class="text-slate-600 dark:text-slate-400">Total Income:</p><p id="total-income" class="font-bold text-green-500 text-lg">$0.00</p></div>
                            <div class="flex justify-between items-center"><p class="text-slate-600 dark:text-slate-400">Total Expenses:</p><p id="total-expenses" class="font-bold text-red-500 text-lg">$0.00</p></div>
                            <hr class="border-slate-200 dark:border-slate-600">
                            <div class="flex justify-between items-center"><p class="font-bold text-lg">Net Profit:</p><p id="net-profit" class="font-bold text-2xl">$0.00</p></div>
                            <div class="flex justify-between items-center text-sm"><p class="text-slate-500">Tax Estimate (20%):</p><p id="tax-estimate" class="font-semibold text-slate-500 dark:text-slate-300">$0.00</p></div>
                            <button id="generate-financial-report-button" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform hover:scale-105 flex items-center justify-center gap-2">
                                âœ¨ Generate Monthly Report
                            </button>
                        </div>
                    </div>
                    <form id="transaction-form" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 space-y-4">
                        <h2 class="text-xl font-semibold mb-2">Add Transaction</h2>
                        <div><input type="text" id="description" placeholder="Description (e.g., Session Fee)" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <div><input type="number" id="amount" step="0.01" placeholder="Amount" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <div><input type="date" id="date" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <fieldset><div class="flex gap-4"><label class="flex items-center"><input type="radio" name="type" value="income" checked class="h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500"><span class="ml-2">Income</span></label><label class="flex items-center"><input type="radio" name="type" value="expense" class="h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500"><span class="ml-2">Expense</span></label></div></fieldset>
                        <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform hover:scale-105">Add Transaction</button>
                    </form>
                </div>
                <div class="lg:col-span-2 space-y-8">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700"><h2 class="text-xl font-semibold mb-4">Income History</h2><div id="income-list" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div></div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700"><h2 class="text-xl font-semibold mb-4">Expense History</h2><div id="expense-list" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- CLIENT MANAGEMENT SCREEN -->
    <div id="client-management-screen" class="screen hidden overflow-y-auto h-screen bg-slate-100 dark:bg-slate-900">
        <div class="p-4 sm:p-6 md:p-8 max-w-7xl mx-auto">
            <header class="flex items-center pb-4 border-b border-slate-200 dark:border-slate-700">
                <button class="back-to-dashboard mr-4 p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                </button>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Client Management</h1>
            </header>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1">
                    <h2 class="text-xl font-semibold mb-4">Add New Client</h2>
                    <form id="new-client-form" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 space-y-4">
                        <div><input type="text" name="client-name" placeholder="Client Name" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <div><input type="text" name="client-contact" placeholder="Contact Info (Email/Phone)" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <div><textarea name="client-notes" rows="4" placeholder="Notes & Preferences" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></textarea></div>
                        <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform hover:scale-105">Save Client</button>
                    </form>
                </div>
                <div class="md:col-span-2">
                    <h2 class="text-xl font-semibold mb-4">Your Clients</h2>
                    <div id="client-list" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCHEDULING SCREEN -->
    <div id="scheduling-screen" class="screen hidden flex flex-col h-screen bg-white dark:bg-slate-800">
        <header class="flex items-center p-4 border-b border-slate-200 dark:border-slate-700 shadow-sm flex-shrink-0">
            <button class="back-to-dashboard mr-4 p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
            </button>
            <h1 class="text-xl sm:text-2xl font-bold text-slate-900 dark:text-white">Calendar</h1>
        </header>
        <main class="flex-grow p-4">
            <div id='calendar' class="h-full"></div>
        </main>
    </div>
    
    <!-- MODALS -->
    <div id="edit-client-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="relative w-full max-w-lg">
            <form id="edit-client-form" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl space-y-4">
                <h3 class="text-lg font-medium text-slate-900 dark:text-white mb-4">Edit Client</h3>
                <input type="hidden" id="edit-client-id">
                <div><input type="text" id="edit-client-name" name="edit-client-name" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div><input type="text" id="edit-client-contact" name="edit-client-contact" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div><textarea id="edit-client-notes" name="edit-client-notes" rows="4" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></textarea></div>
                <div class="flex justify-end gap-4 pt-4">
                    <button id="cancel-edit-button" type="button" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-600 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-event-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="relative w-full max-w-lg">
            <form id="add-event-form" class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl space-y-4">
                <h3 class="text-lg font-medium text-slate-900 dark:text-white mb-4">Add New Appointment</h3>
                <div><input type="text" id="event-title" placeholder="Description" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div><select id="event-client-select" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></select></div>
                <div><input type="date" id="event-start-date" required class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border-transparent rounded-md focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div class="flex justify-end gap-4 pt-4">
                    <button id="cancel-add-event-button" type="button" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-600 dark:hover:bg-slate-500 text-slate-800 dark:text-slate-200 font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Save Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <div id="daily-agenda-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="relative w-full max-w-lg bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl">
            <div class="flex justify-between items-start mb-4">
                <h3 id="agenda-date" class="text-lg font-medium text-slate-900 dark:text-white leading-6">Appointments for...</h3>
                <button id="close-agenda-button" class="p-1 -mt-1 -mr-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="agenda-event-list" class="space-y-3 max-h-60 overflow-y-auto mb-4 pr-2"></div>
            <button id="add-new-event-from-agenda" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Add New Appointment</button>
        </div>
    </div>

    <div id="client-insights-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="relative w-full max-w-lg bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-lg font-medium text-slate-900 dark:text-white leading-6 flex items-center gap-2">âœ¨ AI Client Insights</h3>
                <button id="close-client-insights-button" class="p-1 -mt-1 -mr-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="client-insights-loading" class="text-center p-8"><p class="text-slate-500">Analyzing notes with Gemini...</p></div>
            <div id="client-insights-content" class="hidden prose prose-sm dark:prose-invert max-w-none"></div>
        </div>
    </div>

    <div id="financial-report-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="relative w-full max-w-lg bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-lg font-medium text-slate-900 dark:text-white leading-6 flex items-center gap-2">âœ¨ AI Financial Report (Last 30 Days)</h3>
                <button id="close-financial-report-button" class="p-1 -mt-1 -mr-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="financial-report-loading" class="text-center p-8"><p class="text-slate-500">Generating financial summary with Gemini...</p></div>
            <div id="financial-report-content" class="hidden prose prose-sm dark:prose-invert max-w-none"></div>
        </div>
    </div>
    
</body>
</html>

